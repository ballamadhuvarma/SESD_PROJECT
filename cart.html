<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart - Sell cart</title>
    <link href="styles.css" rel="stylesheet">
</head>

<body>

    <nav>
        <div class="logo">SELL CART</div>
        <div class="links">
            <a href="index.html">Home</a>
            <a href="about-us.html">About Us</a>
            <a href="contact.html">Contact</a>
            <a href="cart.html">Cart (<span id="cart-count">0</span>)</a>
            <a href="login.html">Login</a>
        </div>
    </nav>

    <div class="cart-container">
        <h1>Your Shopping Cart</h1>
        <table>
            <thead>
                <tr>
                    <th>Product Image</th>
                    <th>Product Name</th>
                    <th>Price</th>
                    <th>Quantity</th>
                    <th>Subtotal</th>
                    <th>Remove</th>
                </tr>
            </thead>
            <tbody id="cart-items">
                <!-- Cart items will be dynamically inserted here -->
            </tbody>
        </table>

        <div class="total-section">
            <div id="total-price">Total: ₹0</div>
            <a href="checkout.html">
                <button class="checkout-btn">Proceed to Checkout</button>
            </a>
        </div>
    </div>

    <script>
  // Fetch cart from localStorage
  let cart = JSON.parse(localStorage.getItem('cart')) || [];

  // Update cart count in nav
  function updateCartCount() {
    document.getElementById('cart-count').innerText = cart.length;
  }

  // Display cart items
  function displayCartItems() {
    const cartItemsContainer = document.getElementById('cart-items');
    cartItemsContainer.innerHTML = ''; // Clear

    let total = 0;

    // Ensure items have quantity and numeric price
    cart = cart.map(item => {
      return {
        product: item.product,
        price: Number(item.price) || 0,
        image: item.image || '', // keep empty string if missing
        quantity: Number(item.quantity) > 0 ? Number(item.quantity) : 1
      };
    });

    cart.forEach((item, index) => {
      const subtotal = item.price * item.quantity;
      total += subtotal;

      const defaultImage = 'https://via.placeholder.com/80';

      const row = document.createElement('tr');
      row.innerHTML = `
        <td><img src="${item.image || defaultImage}" alt="${item.product}" width="80"></td>
        <td>${item.product}</td>
        <td>₹${item.price.toLocaleString()}</td>
        <td>
          <input type="number" class="quantity-input" value="${item.quantity}" min="1" onchange="updateQuantity(${index}, this.value)">
        </td>
        <td>₹${(subtotal).toLocaleString()}</td>
        <td><button class="remove-btn" onclick="removeFromCart(${index})">Remove</button></td>
      `;
      cartItemsContainer.appendChild(row);
    });

    document.getElementById('total-price').textContent = 'Total: ₹' + total.toLocaleString();
    // Save any normalization we did (ensuring quantity present)
    localStorage.setItem('cart', JSON.stringify(cart));
  }

  // Update quantity
  function updateQuantity(index, newQuantity) {
    const qty = parseInt(newQuantity, 10);
    if (!isNaN(qty) && qty > 0) {
      cart[index].quantity = qty;
      localStorage.setItem('cart', JSON.stringify(cart));
      displayCartItems();
      updateCartCount();
    }
  }

  // Remove item
  function removeFromCart(index) {
    cart.splice(index, 1);
    localStorage.setItem('cart', JSON.stringify(cart));
    displayCartItems();
    updateCartCount();
  }

  document.addEventListener('DOMContentLoaded', () => {
    updateCartCount();
    displayCartItems();
  });

  // Make functions available to inline handlers (if your environment blocks them)
  window.updateQuantity = updateQuantity;
  window.removeFromCart = removeFromCart;
</script>

</body>

</html>
